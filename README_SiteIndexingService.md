# Описание сервиса SiteIndexingService

`SiteIndexingService` представляет собой сервис для индексации веб-сайтов и извлечения ключевых слов (лемм) для последующего поиска. Ниже приведено подробное описание переменных и методов в этом сервисе.


Здесь изображение диаграммы [взаимодействия классов в сервисе](images/searchengine.png).




## Переменные

### Кеши

#### `pageUrlCache`

Кэш для URL страниц, использующий библиотеку Caffeine для хранения до 600 элементов с временем жизни 10 минут.

#### `lemmaCache`

Кэш для лемм, также использующий библиотеку Caffeine, с максимальным размером 10000 элементов и временем жизни 10 минут.

### Флаги состояния индексации

#### `stopRequested`

Флаг, указывающий на запрос остановки индексации.

#### `indexingInProgress`

Флаг, показывающий, идет ли в данный момент процесс индексации.

### Другие переменные

#### `parallelism`

Количество параллельных потоков в пуле ForkJoinPool для выполнения индексации.

## Методы

### `startIndexing`

Метод для начала индексации списка сайтов. Запускает процесс индексации для каждого сайта в отдельном потоке.

### `stopIndex`

Метод для остановки текущего процесса индексации. Устанавливает флаг `stopRequested`, чтобы остановить выполнение индексации на следующем возможном шаге.

### `indexSites`

Метод для индексации списка сайтов. Использует ForkJoinPool для параллельной обработки каждого сайта из списка.

### `clearCache`

Метод для очистки кэшей `pageUrlCache` и `lemmaCache`. Вызывается для освобождения памяти после завершения индексации.

### `indexSite`

Метод для индексации конкретного сайта. Извлекает содержимое страниц сайта, извлекает ключевые слова (леммы) и сохраняет их в кэше.

### `normalizeUrl`

Метод для нормализации URL-адреса. Приводит URL к стандартному формату, учитывая протокол, домен и путь.

### `visitPage`

Метод для посещения страницы сайта и извлечения контента. Использует библиотеку для HTTP-запросов для получения HTML-кода страницы.

### `isFileUrl`

Метод для проверки, является ли URL файлом. Определяет тип ссылки (страница или файл) на основе расширения файла в URL.

### `createPageEntity`

Метод для создания объекта `PageEntity` на основе HTML-контента страницы. Извлекает заголовок, мета-теги и основное содержимое страницы.

### `extractLinksAndIndexPages`

Метод для извлечения ссылок со страницы и их последующей индексации. Извлекает все ссылки с HTML-страницы и добавляет их в список индексации.

### `getOrCreateLemma`

Метод для получения или создания сущности леммы. Проверяет наличие леммы в кэше и создает новую, если она отсутствует.

### `saveLemmasAndIndices`

Метод для сохранения лемм и индексов. Сохраняет извлеченные леммы и индексы в кэш для последующего использования при поиске.

### `isInternalLink`

Метод для проверки, является ли ссылка внутренней для сайта. Определяет, принадлежит ли ссылка тому же домену, что и сайт, или ведет на внешний ресурс.

### `updateSiteStatus`

Метод для обновления статуса сайта после индексации. Устанавливает флаги и записывает результаты индексации в базу данных.

### `indexPage`

Метод для индексации отдельной страницы по её URL. Извлекает ключевые слова (леммы) и сохраняет их в кэше.

### `performSearch`

Метод для выполнения поиска по заданному запросу и сайту. Использует сохраненные леммы и индексы для быстрого поиска соответствующих страниц.

### `sortLemmasByFrequency`

Метод для сортировки лемм по частоте их использования. Позволяет оптимизировать поиск, упорядочивая наиболее часто встречающиеся ключевые слова.

### `filterFrequentLemmas`

Метод для фильтрации часто встречающихся лемм. Уменьшает размер индекса, исключая наиболее общие ключевые слова.

### `findPagesByLemmas`

Метод для поиска страниц по заданным леммам и сайту. Использует индексы для быстрого поиска страниц, содержащих заданные ключевые слова.

### `calculateRelevance`

Метод для расчёта релевантности страницы по заданным леммам. Оценивает, насколько страница соответствует запросу пользователя на основе наличия ключевых слов.

### `createSearchResult`

Метод для создания объекта `SearchResultDto` на основе страницы и релевантности. Формирует структуру данных для отображения результатов поиска пользователю.


Данный список методов представляет основные функции сервиса `SiteIndexingService`, включая индексацию, поиск и обработку данных.

